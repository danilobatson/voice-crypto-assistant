version: 1
environment:
  variables:
    NODE_OPTIONS: '--max-old-space-size=4096'
    NEXT_TELEMETRY_DISABLED: 1
    NPM_CONFIG_UNSAFE_PERM: true
frontend:
  phases:
    preBuild:
      commands:
        - echo "=== Pre-build Phase ==="
        - echo "Node version:" && node --version
        - echo "NPM version:" && npm --version
        - echo "Available memory:" && free -m || echo "Memory info not available"
        - echo "Cleaning previous builds..."
        - rm -rf node_modules package-lock.json .next
        - echo "Installing dependencies..."
        - npm install --no-optional --no-audit --no-fund
        - echo "Disabling Next.js telemetry..."
        - npx next telemetry disable
        - echo "=== Pre-build Complete ==="
    build:
      commands:
        - echo "=== Build Phase ==="
        - echo "Starting Next.js build..."
        - npm run build
        - echo "=== Build Complete ==="
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
